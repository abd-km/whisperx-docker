{{- if and .Values.ingress.enabled (eq .Values.ingress.className "traefik") }}
---
# Traefik middleware for handling large audio file uploads
apiVersion: traefik.containo.us/v1alpha1
kind: Middleware
metadata:
  name: {{ include "whisperx-api.fullname" . }}-timeout
  labels:
    {{- include "whisperx-api.labels" . | nindent 4 }}
spec:
  buffering:
    maxRequestBodyBytes: 104857600   # 100MB
    memRequestBodyBytes: 104857600   # Keep in memory
    maxResponseBodyBytes: 104857600
    memResponseBodyBytes: 104857600
{{- end }}

